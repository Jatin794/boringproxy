version: '3.8'

services:
  boringproxy:
    # Build the image from the source code in the repository.
    build: .
    image: boringproxy
    container_name: boringproxy-nscswcwo0skw0og8g4k4woo8-181839333464
    restart: unless-stopped

    # The correct command for the modern, self-built binary.
    command:
      - "server"
      - "-behind-proxy"
      - "-admin-domain"
      - "admin.tunnel.183816.xyz"
      - "-http-port"
      - "8000"
      - "-tunnel-port"
      - "8443"
      - "-db-dir"
      - "/data"

    # Correct port mapping: No 80/443 conflict, only exposes the tunnel port.
    ports:
      - '8443:8443'

    labels:
      # --- Traefik Instructions ---
      - "traefik.enable=true"
      # This label explicitly tells Traefik to use the Coolify-generated network to connect.
      - "traefik.docker.network=nscswcwo0skw0og8g4k4woo8"
      - "traefik.http.routers.boringproxy-admin.rule=Host(`admin.tunnel.183816.xyz`)"
      - "traefik.http.routers.boringproxy-admin.entrypoints=websecure"
      - "traefik.http.routers.boringproxy-admin.service=boringproxy-admin-svc"
      - "traefik.http.routers.boringproxy-admin.tls.certresolver=myresolver" # Replace with your resolver name
      - "traefik.http.services.boringproxy-admin-svc.loadbalancer.server.port=8000"

volumes:
  boringproxy-data:

